<p-fluid>
    <div class="card">
        <div class="font-semibold text-xl mb-5">Bank Branch Setup</div>

        <form [formGroup]="bankBranchForm" (ngSubmit)="onSubmit()">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">

                <!-- Bank -->
                <div class="field">
                    <label for="bankId" class="block mb-2">
                        Bank <span class="text-red-500">*</span>
                    </label>
                    <p-select
                        id="bankId"
                        formControlName="bankId"
                        [options]="banks"
                        optionLabel="bankNameEN"
                        optionValue="bankId"
                        placeholder="Select Bank"
                        styleClass="w-full">
                    </p-select>
                    @if (bankBranchForm.get('bankId')?.invalid && bankBranchForm.get('bankId')?.touched) {
                        <small class="text-red-500 block mt-1">
                            Bank is required
                        </small>
                    }
                </div>

                <!-- Branch Name EN -->
                <div class="field">
                    <label for="branchNameEN" class="block mb-2">
                        Branch Name (English) <span class="text-red-500">*</span>
                    </label>
                    <input pInputText id="branchNameEN"
                           formControlName="branchNameEN"
                           placeholder="Enter branch name (English)"
                           class="w-full" />
                    @if (bankBranchForm.get('branchNameEN')?.invalid && bankBranchForm.get('branchNameEN')?.touched) {
                        <small class="text-red-500 block mt-1">
                            Branch Name (English) is required
                        </small>
                    }
                </div>

                <!-- Branch Name BN -->
                <div class="field">
                    <label for="branchNameBN" class="block mb-2">
                        Branch Name (Bangla)
                    </label>
                    <input pInputText id="branchNameBN"
                           formControlName="branchNameBN"
                           placeholder="Enter branch name (Bangla)"
                           class="w-full" />
                </div>

                <!-- Location -->
                <div class="field md:col-span-2">
                    <label for="location" class="block mb-2">
                        Location
                    </label>
                    <input pInputText id="location"
                           formControlName="location"
                           placeholder="Enter location/address"
                           class="w-full" />
                </div>

            </div>

            <!-- Buttons -->
            <div class="flex justify-end gap-2">
                <p-button
                    [label]="editingId ? 'Update' : 'Save'"
                    type="submit"
                    [disabled]="bankBranchForm.invalid || isSubmitting">
                </p-button>

                <p-button
                    label="Reset"
                    icon="pi pi-refresh"
                    severity="secondary"
                    type="button"
                    (onClick)="onReset()"
                    [disabled]="isSubmitting">
                </p-button>
            </div>
        </form>
    </div>
</p-fluid>

<div class="card mt-4">
    <div class="flex justify-between items-center flex-column sm:flex-row mb-4">
        <p-iconfield iconPosition="left" class="ml-auto">
            <p-inputicon>
                <i class="pi pi-search"></i>
            </p-inputicon>
            <input
                pInputText
                type="text"
                placeholder="Search branch or location"
                (input)="onSearch($event)" />
        </p-iconfield>
    </div>

    <p-table
        [value]="filteredBankBranches"
        [paginator]="true"
        [first]="first"
        [rows]="rows"
        [totalRecords]="totalRecords"
        [rowsPerPageOptions]="[10, 25, 50]">

        <ng-template pTemplate="header">
            <tr>
                <th style="width:5%">#</th>
                <th>Bank</th>
                <th>Branch Name (English)</th>
                <th>Branch Name (Bangla)</th>
                <th>Location</th>
                <th style="width:15%">Action</th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-row let-rowIndex="rowIndex">
            <tr>
                <td>{{ first + rowIndex + 1 }}</td>
                <td>{{ getBankName(row.bankId) || '-' }}</td>
                <td>{{ row.branchNameEN }}</td>
                <td>{{ row.branchNameBN || '-' }}</td>
                <td>{{ row.location || '-' }}</td>

                <td>
                    <div class="flex gap-2">
                        <button
                            pButton
                            icon="pi pi-pencil"
                            (click)="onEdit(row)">
                        </button>

                        <button
                            pButton
                            icon="pi pi-trash"
                            class="p-button-danger"
                            (click)="onDelete(row, $event)">
                        </button>
                    </div>
                </td>
            </tr>
        </ng-template>

    </p-table>
</div>
