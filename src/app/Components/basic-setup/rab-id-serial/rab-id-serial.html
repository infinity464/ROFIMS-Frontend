<p-fluid>
    <div class="card">
        <div class="font-semibold text-xl mb-5">RAB ID Serial Setup</div>

        <form [formGroup]="rabIdSerialForm" (ngSubmit)="onSubmit()">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">

                <!-- Officer Type -->
                <div class="field">
                    <label for="officerTypeId" class="block mb-2">
                        Officer Type <span class="text-red-500">*</span>
                    </label>
                    <p-select
                        id="officerTypeId"
                        formControlName="officerTypeId"
                        [options]="officerTypeOptions"
                        optionLabel="label"
                        optionValue="value"
                        placeholder="Select Officer Type"
                        class="w-full">
                    </p-select>
                    @if (rabIdSerialForm.get('officerTypeId')?.invalid && rabIdSerialForm.get('officerTypeId')?.touched) {
                        <small class="text-red-500 block mt-1">
                            Officer Type is required
                        </small>
                    }
                </div>

                <!-- Min ID -->
                <div class="field">
                    <label for="minId" class="block mb-2">
                        Min ID <span class="text-red-500">*</span>
                    </label>
                    <p-inputnumber
                        id="minId"
                        formControlName="minId"
                        placeholder="Enter Min ID"
                        [useGrouping]="false"
                        class="w-full">
                    </p-inputnumber>
                    @if (rabIdSerialForm.get('minId')?.invalid && rabIdSerialForm.get('minId')?.touched) {
                        <small class="text-red-500 block mt-1">
                            Min ID is required and must be greater than 0
                        </small>
                    }
                </div>

                <!-- Max ID -->
                <div class="field">
                    <label for="maxId" class="block mb-2">
                        Max ID <span class="text-red-500">*</span>
                    </label>
                    <p-inputnumber
                        id="maxId"
                        formControlName="maxId"
                        placeholder="Enter Max ID"
                        [useGrouping]="false"
                        class="w-full">
                    </p-inputnumber>
                    @if (rabIdSerialForm.get('maxId')?.invalid && rabIdSerialForm.get('maxId')?.touched) {
                        <small class="text-red-500 block mt-1">
                            Max ID is required and must be greater than 0
                        </small>
                    }
                    @if (rabIdSerialForm.get('maxId')?.value && rabIdSerialForm.get('minId')?.value && rabIdSerialForm.get('maxId')?.value < rabIdSerialForm.get('minId')?.value) {
                        <small class="text-red-500 block mt-1">
                            Max ID cannot be less than Min ID
                        </small>
                    }
                </div>

            </div>

            <!-- Buttons -->
            <div class="flex justify-end gap-2">
                <p-button
                    label="Save"
                    type="submit"
                    [disabled]="rabIdSerialForm.invalid || isSubmitting || isMaxLessThanMin()">
                </p-button>

                <p-button
                    label="Reset"
                    icon="pi pi-refresh"
                    severity="secondary"
                    type="button"
                    (onClick)="onReset()"
                    [disabled]="isSubmitting">
                </p-button>
            </div>
        </form>
    </div>
</p-fluid>

<div class="card mt-4">
    <div class="flex justify-between items-center flex-column sm:flex-row mb-4">
        <p-iconfield iconPosition="left" class="ml-auto">
            <p-inputicon>
                <i class="pi pi-search"></i>
            </p-inputicon>
            <input
                pInputText
                type="text"
                placeholder="Search RAB ID Serial"
                (input)="onSearch($event)" />
        </p-iconfield>
    </div>

    <p-table
        [value]="filteredRabIdSerials"
        [paginator]="true"
        [first]="first"
        [rows]="rows"
        [totalRecords]="totalRecords"
        [rowsPerPageOptions]="[10, 25, 50]">

        <ng-template pTemplate="header">
            <tr>
                <th style="width:5%">#</th>
                <th>Officer Type</th>
                <th>Min ID</th>
                <th>Max ID</th>
                <th>Current ID</th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-row let-rowIndex="rowIndex">
            <tr>
                <td>{{ first + rowIndex + 1 }}</td>
                <td>{{ getOfficerTypeName(row.officerTypeId) }}</td>
                <td>{{ row.minId }}</td>
                <td>{{ row.maxId }}</td>
                <td>{{ row.currentId ?? '-' }}</td>
            </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="6" class="text-center">No records found.</td>
            </tr>
        </ng-template>

    </p-table>
</div>
