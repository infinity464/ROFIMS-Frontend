<p-toast></p-toast>

<div class="card serving-member-profile-page text-900">
    <div class="profile-header">
        <div class="profile-header-left">
            <p-button icon="pi pi-arrow-left" [label]="L['button.back']" [rounded]="true" [text]="true" severity="secondary" (onClick)="goBack()" styleClass="p-button-sm"></p-button>
            <h1 class="profile-title m-0 text-2xl font-bold text-900">{{ L['pageTitle.servingMember'] }}</h1>
            <p-button [label]="profileLang === 'en' ? 'বাংলা' : 'English'" [rounded]="true" [text]="true" severity="secondary" (onClick)="toggleProfileLang()" styleClass="p-button-sm ml-2"></p-button>
        </div>
        <div class="profile-image-box">
            @if (profileImageUrl) {
                <img [src]="profileImageUrl" alt="Profile" class="profile-image" />
            } @else {
                <div class="profile-image-placeholder" aria-hidden="true">
                    <i class="pi pi-user"></i>
                </div>
            }
        </div>
    </div>

    @if (loading) {
        <div class="flex align-items-center justify-content-center p-5">
            <i class="pi pi-spin pi-spinner text-4xl text-500"></i>
        </div>
    } @else if (profile) {
        <!-- Basic Service Information -->
        <div class="content-section text-900">
            <div class="section-heading">{{ L['section.basicService'] }}</div>
            <div class="core-details">
                <div class="core-row">
                    <span class="detail-item"><span class="detail-label">{{ L['field.serviceId'] }}  </span> <span class="detail-value">{{ valDisplay(profile.serviceId) }}</span></span>
                    <span class="detail-item"><span class="detail-label">{{ L['field.rabId'] }}  </span> <span class="detail-value">{{ valDisplay(profile.rabId) }}</span></span>
                </div>
                <div class="core-row core-row-full">
                    <span class="detail-item"><span class="detail-label">{{ isBn ? L['field.nameBangla'] : L['field.nameEnglish'] }} </span> <span class="detail-value">{{ getFormattedName(profile) }}</span></span>
                </div>
                <div class="core-row core-row-four">
                    <span class="detail-item"><span class="detail-label">{{ L['field.appointment'] }} </span> <span class="detail-value">{{ codeValue(profile.appointment, profile.appointmentBN) }}</span></span>
                    <span class="detail-item"><span class="detail-label">{{ L['field.memberType'] }} </span> <span class="detail-value">{{ codeValue(profile.memberType, profile.memberTypeBN) }}</span></span>
                    <span class="detail-item"><span class="detail-label">{{ L['field.motherOrganization'] }} </span> <span class="detail-value">{{ codeValue(profile.motherOrganization, profile.motherOrganizationBN) }}</span></span>
                    <span class="detail-item"><span class="detail-label">{{ L['field.rank'] }} </span> <span class="detail-value">{{ codeValue(profile.armyRank, profile.armyRankBN) }}</span></span>
                </div>
                <div class="core-row core-row-four">
                    <span class="detail-item"><span class="detail-label">{{ L['field.corps'] }} </span> <span class="detail-value">{{ codeValue(profile.corps, profile.corpsBN) }}</span></span>
                    <span class="detail-item"><span class="detail-label">{{ L['field.trade'] }} </span> <span class="detail-value">{{ tradeDisplay(profile) }}</span></span>
                    <span class="detail-item"><span class="detail-label">{{ L['field.dateOfCommission'] }} </span> <span class="detail-value">{{ formatDateDisplay(profile.dateOfCommission) }}</span></span>
                </div>
                <div class="core-row core-row-three">
                    <span class="detail-item"><span class="detail-label">{{ L['field.dateOfJoiningInServiceTraining'] }} </span> <span class="detail-value">{{ formatDateDisplay(profile.dateOfJoiningInServiceTraining) }}</span></span>
                    <span class="detail-item"><span class="detail-label">{{ L['field.motherUnit'] }} </span> <span class="detail-value">{{ codeValue(profile.motherUnit, profile.motherUnitBN) }}</span></span>
                    <span class="detail-item"><span class="detail-label">{{ L['field.location'] }} </span> <span class="detail-value">{{ codeValue(profile.location, profile.locationBN) }}</span></span>
                </div>
                <div class="core-row">
                    <span class="detail-item"><span class="detail-label">{{ L['field.rabUnit'] }} </span> <span class="detail-value">{{ codeValue(profile.rabUnit, profile.rabUnitBN) }}</span></span>
                    <span class="detail-item"><span class="detail-label">{{ L['field.joiningDate'] }} </span> <span class="detail-value">{{ formatDateDisplay(profile.joiningDate) }}</span></span>
                </div>
            </div>
        </div>

                <!-- Own Address Information (Permanent & Present; multiple allowed) -->
                <div class="content-section text-900 border-top-1 surface-border">
                    <div class="section-heading">{{ L['section.ownAddress'] }}</div>
                    @if (ownAddressList.length === 0) {
                        <div class="address-empty text-500 py-2">{{ L['empty.noOwnAddress'] }}</div>
                    } @else {
                        <div class="core-details">
                            @for (addr of ownAddressList; track addr.ser) {
                                <div class="address-block">
                                    <div class="address-block-type">{{ getAddressTypeLabel(addr) }}</div>
                                    <div class="address-fields">
                                        <div class="address-row">
                                            <span class="address-field"><span class="address-label">{{ L['address.houseArea'] }}</span> {{ val(addr.houseRoad) }}</span>
                                            <span class="address-field"><span class="address-label">{{ L['address.village'] }}</span> {{ val(addr.addressAreaEN) }}</span>
                                            <span class="address-field"><span class="address-label">{{ L['address.postOffice'] }}</span> {{ codeValue(addr.postOffice, addr.postOfficeBN) }}</span>
                                        </div>
                                        <div class="address-row">
                                            <span class="address-field"><span class="address-label">{{ L['address.thana'] }}</span> {{ codeValue(addr.thana, addr.thanaBN) }}</span>
                                            <span class="address-field"><span class="address-label">{{ L['address.district'] }}</span> {{ codeValue(addr.district, addr.districtBN) }}</span>
                                            <span class="address-field"><span class="address-label">{{ L['address.division'] }}</span> {{ codeValue(addr.division, addr.divisionBN) }}</span>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                </div>
        
                <!-- Wife Address Information (WifePermanent & WifePresent; multiple allowed) -->
                <div class="content-section text-900 border-top-1 surface-border">
                    <div class="section-heading">{{ L['section.wifeAddress'] }}</div>
                    @if (wifeAddressList.length === 0) {
                        <div class="address-empty text-500 py-2">{{ L['empty.noWifeAddress'] }}</div>
                    } @else {
                        <div class="core-details">
                            @for (addr of wifeAddressList; track addr.ser) {
                                <div class="address-block">
                                    <div class="address-block-type">{{ getAddressTypeLabel(addr) }}</div>
                                    <div class="address-fields">
                                        <div class="address-row">
                                            <span class="address-field"><span class="address-label">{{ L['address.houseArea'] }}</span> {{ val(addr.houseRoad) }}</span>
                                            <span class="address-field"><span class="address-label">{{ L['address.village'] }}</span> {{ val(addr.addressAreaEN) }}</span>
                                            <span class="address-field"><span class="address-label">{{ L['address.postOffice'] }}</span> {{ codeValue(addr.postOffice, addr.postOfficeBN) }}</span>
                                        </div>
                                        <div class="address-row">
                                            <span class="address-field"><span class="address-label">{{ L['address.thana'] }}</span> {{ codeValue(addr.thana, addr.thanaBN) }}</span>
                                            <span class="address-field"><span class="address-label">{{ L['address.district'] }}</span> {{ codeValue(addr.district, addr.districtBN) }}</span>
                                            <span class="address-field"><span class="address-label">{{ L['address.division'] }}</span> {{ codeValue(addr.division, addr.divisionBN) }}</span>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                </div>

        <!-- Other Personal Information -->
        <div class="content-section text-900 border-top-1 surface-border">
            <div class="section-heading">{{ L['section.otherPersonal'] }}</div>
            <div class="core-details">
                <div class="core-row core-row-four">
                    <span class="detail-item"><span class="detail-label">{{ L['field.courseBatch'] }} </span> <span class="detail-value">{{ codeValue(profile.batch, profile.batchBN) }}</span></span>
                    <span class="detail-item"><span class="detail-label">{{ L['field.dateOfJoinInService'] }} </span> <span class="detail-value">{{ formatDateDisplay(profile.dateOfJoiningInServiceTraining) }}</span></span>
                    <span class="detail-item"><span class="detail-label">{{ L['field.dateOfCommission'] }} </span> <span class="detail-value">{{ formatDateDisplay(profile.dateOfCommission) }}</span></span>
                    <span class="detail-item"><span class="detail-label">{{ L['field.educationQualification'] }} </span> <span class="detail-value">{{ codeValue(profile.educationQualification, profile.educationQualificationBN) }}</span></span>
                </div>
                <div class="core-row core-row-four">
                    <span class="detail-item"><span class="detail-label">{{ L['field.professionalQualification'] }} </span> <span class="detail-value">{{ codeValue(profile.professionalQualification, profile.professionalQualificationBN) }}</span></span>
                    <span class="detail-item"><span class="detail-label">{{ L['field.personalQualification'] }} </span> <span class="detail-value">{{ codeValue(profile.personalQualification, profile.personalQualificationBN) }}</span></span>
                    <span class="detail-item"><span class="detail-label">{{ L['field.gallantryAwards'] }} </span> <span class="detail-value">{{ codeValue(profile.gallantryAwardsDecoration, profile.gallantryAwardsDecorationBN) }}</span></span>
                    <span class="detail-item"><span class="detail-label">{{ L['field.bloodGroup'] }} </span> <span class="detail-value">{{ val(profile.bloodGroup) }}</span></span>
                </div>
                <div class="core-row core-row-four">
                    <span class="detail-item"><span class="detail-label">{{ L['field.nid'] }} </span> <span class="detail-value">{{ valDisplay(profile.nid) }}</span></span>
                    <span class="detail-item"><span class="detail-label">{{ L['field.emailAddress'] }} </span> <span class="detail-value">{{ val(profile.emailAddress) }}</span></span>
                    <span class="detail-item"><span class="detail-label">{{ L['field.dateOfBirth'] }} </span> <span class="detail-value">{{ formatDateDisplay(profile.dateOfBirth) }}</span></span>
                    <span class="detail-item"><span class="detail-label">{{ L['field.passportNo'] }} </span> <span class="detail-value">{{ valDisplay(profile.passportNo) }}</span></span>
                </div>
                <div class="core-row core-row-four">
                    <span class="detail-item"><span class="detail-label">{{ L['field.height'] }} </span> <span class="detail-value">{{ heightDisplay(profile) }}</span></span>
                    <span class="detail-item"><span class="detail-label">{{ L['field.medicalCategory'] }} </span> <span class="detail-value">{{ codeValue(profile.medicalCategory, profile.medicalCategoryBN) }}</span></span>
                    <span class="detail-item"><span class="detail-label">{{ L['field.mobileNo'] }} </span> <span class="detail-value">{{ valDisplay(profile.mobileNo) }}</span></span>
                    <span class="detail-item"><span class="detail-label">{{ L['field.emergencyContactNo'] }} </span> <span class="detail-value">{{ valDisplay(profile.emergencyContactNo) }}</span></span>
                </div>
                <div class="core-row core-row-four">
                    <span class="detail-item"><span class="detail-label">{{ L['field.religion'] }} </span> <span class="detail-value">{{ codeValue(profile.religion, profile.religionBN) }}</span></span>
                    <span class="detail-item"><span class="detail-label">{{ L['field.maritalStatus'] }} </span> <span class="detail-value">{{ codeValue(profile.maritalStatus, profile.maritalStatusBN) }}</span></span>
                    <span class="detail-item"><span class="detail-label">{{ L['field.weight'] }} </span> <span class="detail-value">{{ weightDisplay(profile) }}</span></span>
                </div>
                <div class="core-row core-row-full">
                    <span class="detail-item"><span class="detail-label">{{ L['field.identificationMark'] }} </span> <span class="detail-value">{{ val(profile.identificationMark) }}</span></span>
                </div>
            </div>
        </div>

        <!-- Family Info (excludes in-law relations) -->
        <div class="content-section text-900 border-top-1 surface-border">
            <div class="section-heading">{{ L['section.familyInfo'] }}</div>
            <div class="family-table-wrapper">
                <p-table
                    [value]="familyInfoList"
                    [tableStyle]="{ 'min-width': '40rem' }"
                    styleClass="p-datatable-sm p-datatable-gridlines family-info-table"
                >
                    <ng-template pTemplate="header">
                        <tr>
                            <th style="width: 4rem">{{ L['table.ser'] }}</th>
                            <th>{{ L['table.name'] }}</th>
                            <th>{{ L['table.relation'] }}</th>
                            <th>{{ L['table.dateOfBirth'] }}</th>
                            <th>{{ L['table.occupation'] }}</th>
                            <th>{{ L['table.mobileNo'] }}</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-row let-rowIndex="rowIndex">
                        <tr>
                            <td>{{ rowNum(rowIndex) }}.</td>
                            <td>{{ codeValue(row.name, row.nameBN) }}</td>
                            <td>{{ codeValue(row.relation, row.relationBN) }}</td>
                            <td>{{ formatFamilyDob(row.dateOfBirth) }}</td>
                            <td>{{ codeValue(row.occupation, row.occupationBN) }}</td>
                            <td>{{ familyMobile(row) }}</td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="6" class="text-center text-500 py-3">{{ L['empty.noFamilyRecords'] }}</td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>

        <!-- Wife Family Info (relation contains "in-law") -->
        <div class="content-section text-900 border-top-1 surface-border">
            <div class="section-heading">{{ L['section.wifeFamilyInfo'] }}</div>
            <div class="family-table-wrapper">
                <p-table
                    [value]="wifeFamilyInfoList"
                    [tableStyle]="{ 'min-width': '40rem' }"
                    styleClass="p-datatable-sm p-datatable-gridlines family-info-table"
                >
                    <ng-template pTemplate="header">
                        <tr>
                            <th style="width: 4rem">{{ L['table.ser'] }}</th>
                            <th>{{ L['table.name'] }}</th>
                            <th>{{ L['table.relation'] }}</th>
                            <th>{{ L['table.dateOfBirth'] }}</th>
                            <th>{{ L['table.occupation'] }}</th>
                            <th>{{ L['table.mobileNo'] }}</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-row let-rowIndex="rowIndex">
                        <tr>
                            <td>{{ rowNum(rowIndex) }}.</td>
                            <td>{{ codeValue(row.name, row.nameBN) }}</td>
                            <td>{{ codeValue(row.relation, row.relationBN) }}</td>
                            <td>{{ formatFamilyDob(row.dateOfBirth) }}</td>
                            <td>{{ codeValue(row.occupation, row.occupationBN) }}</td>
                            <td>{{ familyMobile(row) }}</td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="6" class="text-center text-500 py-3">{{ L['empty.noWifeFamilyRecords'] }}</td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>

        <!-- Present RAB Service Info (IsCurrentlyActive = true) -->
        <div class="content-section text-900 border-top-1 surface-border">
            <div class="section-heading">{{ L['section.presentRabService'] }}</div>
            <div class="family-table-wrapper">
                <p-table
                    [value]="presentRabList"
                    [tableStyle]="{ 'min-width': '50rem' }"
                    styleClass="p-datatable-sm p-datatable-gridlines family-info-table"
                >
                    <ng-template pTemplate="header">
                        <tr>
                            <th style="width: 4rem">{{ L['table.ser'] }}</th>
                            <th>{{ L['table.rabUnit'] }}</th>
                            <th>{{ L['table.serviceFrom'] }}</th>
                            <th>{{ L['table.serviceTo'] }}</th>
                            <th>{{ L['table.appointment'] }}</th>
                            <th>{{ L['table.postingAuth'] }}</th>
                            <th>{{ L['table.remarks'] }}</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-row let-rowIndex="rowIndex">
                        <tr>
                            <td>{{ rowNum(rowIndex) }}.</td>
                            <td>{{ codeValue(row.rabUnitName, row.rabUnitNameBN) }}</td>
                            <td>{{ formatDateOnly(row.serviceFrom) }}</td>
                            <td>{{ formatDateOnly(row.serviceTo) }}</td>
                            <td>{{ codeValue(row.appointmentName, row.appointmentNameBN) }}</td>
                            <td>{{ val(row.postingAuth) }}</td>
                            <td>{{ val(row.remarks) }}</td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="7" class="text-center text-500 py-3">{{ L['empty.noPresentRabRecords'] }}</td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>

        <!-- Previous RAB Service Information (IsCurrentlyActive = false) -->
        <div class="content-section text-900 border-top-1 surface-border">
            <div class="section-heading">{{ L['section.previousRabService'] }}</div>
            <div class="family-table-wrapper">
                <p-table
                    [value]="previousOnlyRabList"
                    [tableStyle]="{ 'min-width': '50rem' }"
                    styleClass="p-datatable-sm p-datatable-gridlines family-info-table"
                >
                    <ng-template pTemplate="header">
                        <tr>
                            <th style="width: 4rem">{{ L['table.ser'] }}</th>
                            <th>{{ L['table.rabUnit'] }}</th>
                            <th>{{ L['table.serviceFrom'] }}</th>
                            <th>{{ L['table.serviceTo'] }}</th>
                            <th>{{ L['table.appointment'] }}</th>
                            <th>{{ L['table.postingAuth'] }}</th>
                            <th>{{ L['table.remarks'] }}</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-row let-rowIndex="rowIndex">
                        <tr>
                            <td>{{ rowNum(rowIndex) }}.</td>
                            <td>{{ codeValue(row.rabUnitName, row.rabUnitNameBN) }}</td>
                            <td>{{ formatDateOnly(row.serviceFrom) }}</td>
                            <td>{{ formatDateOnly(row.serviceTo) }}</td>
                            <td>{{ codeValue(row.appointmentName, row.appointmentNameBN) }}</td>
                            <td>{{ val(row.postingAuth) }}</td>
                            <td>{{ val(row.remarks) }}</td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="7" class="text-center text-500 py-3">{{ L['empty.noPreviousRabRecords'] }}</td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>

         <!-- Service History (Mother Organization) -->
         <div class="content-section text-900 border-top-1 surface-border">
            <div class="section-heading">{{ L['section.serviceHistoryMo'] }}</div>
            <div class="family-table-wrapper">
                <p-table
                    [value]="moServHistoryList"
                    [tableStyle]="{ 'min-width': '48rem' }"
                    styleClass="p-datatable-sm p-datatable-gridlines family-info-table"
                >
                    <ng-template pTemplate="header">
                        <tr>
                            <th style="width: 4rem">{{ L['table.ser'] }}</th>
                            <th>{{ L['table.organization'] }}</th>
                            <th>{{ L['table.location'] }}</th>
                            <th>{{ L['table.serviceFrom'] }}</th>
                            <th>{{ L['table.serviceTo'] }}</th>
                            <th>{{ L['table.appointment'] }}</th>
                            <th>{{ L['table.auth'] }}</th>
                            <th>{{ L['table.remarks'] }}</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-row let-rowIndex="rowIndex">
                        <tr>
                            <td>{{ rowNum(rowIndex) }}.</td>
                            <td>{{ val(row.organizationName) }}</td>
                            <td>{{ val(row.locationName) }}</td>
                            <td>{{ formatDateOnly(row.serviceFrom) }}</td>
                            <td>{{ formatDateOnly(row.serviceTo) }}</td>
                            <td>{{ codeValue(row.appointment, row.appointmentBN) }}</td>
                            <td>{{ val(row.auth) }}</td>
                            <td>{{ val(row.remarks) }}</td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="8" class="text-center text-500 py-3">{{ L['empty.noServiceHistoryRecords'] }}</td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>
        
        <!-- Promotion Information -->
        <div class="content-section text-900 border-top-1 surface-border">
            <div class="section-heading">{{ L['section.promotion'] }}</div>
            <div class="family-table-wrapper">
                <p-table
                    [value]="promotionList"
                    [tableStyle]="{ 'min-width': '52rem' }"
                    styleClass="p-datatable-sm p-datatable-gridlines family-info-table"
                >
                    <ng-template pTemplate="header">
                        <tr>
                            <th style="width: 4rem">{{ L['table.ser'] }}</th>
                            <th>{{ L['table.previousRank'] }}</th>
                            <th>{{ L['table.promotedRank'] }}</th>
                            <th>{{ L['table.promotedDate'] }}</th>
                            <th>{{ L['table.fromDate'] }}</th>
                            <th>{{ L['table.toDate'] }}</th>
                            <th>{{ L['table.probationaryPeriod'] }}</th>
                            <th>{{ L['table.auth'] }}</th>
                            <th>{{ L['table.remarks'] }}</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-row let-rowIndex="rowIndex">
                        <tr>
                            <td>{{ rowNum(rowIndex) }}.</td>
                            <td>{{ codeValue(row.previousRank, row.previousRankBN) }}</td>
                            <td>{{ codeValue(row.promotedRank, row.promotedRankBN) }}</td>
                            <td>{{ formatDateOnly(row.promotedDate) }}</td>
                            <td>{{ formatDateOnly(row.fromDate) }}</td>
                            <td>{{ formatDateOnly(row.toDate) }}</td>
                            <td>{{ val(row.probationaryPeriod) }}</td>
                            <td>{{ val(row.auth) }}</td>
                            <td>{{ val(row.remarks) }}</td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="9" class="text-center text-500 py-3">{{ L['empty.noPromotionRecords'] }}</td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>

         <!-- Education Information -->
         <div class="content-section text-900 border-top-1 surface-border">
            <div class="section-heading">{{ L['section.education'] }}</div>
            <div class="family-table-wrapper">
                <p-table
                    [value]="educationList"
                    [tableStyle]="{ 'min-width': '56rem' }"
                    styleClass="p-datatable-sm p-datatable-gridlines family-info-table"
                >
                    <ng-template pTemplate="header">
                        <tr>
                            <th style="width: 4rem">{{ L['table.ser'] }}</th>
                            <th>{{ L['table.durationFrom'] }}</th>
                            <th>{{ L['table.durationTo'] }}</th>
                            <th>{{ L['table.schoolCollegeUniversity'] }}</th>
                            <th>{{ L['table.examDegree'] }}</th>
                            <th>{{ L['table.subjectDepartment'] }}</th>
                            <th>{{ L['table.result'] }}</th>
                            <th>{{ L['table.gradePoint'] }}</th>
                            <th>{{ L['table.passingYear'] }}</th>
                            <!-- Remarks column hidden in UI (backend still has remarks) -->
                            <!-- <th>{{ L['table.remarks'] }}</th> -->
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-row let-rowIndex="rowIndex">
                        <tr>
                            <td>{{ rowNum(rowIndex) }}.</td>
                            <td>{{ formatDateOnly(row.durationFrom) }}</td>
                            <td>{{ formatDateOnly(row.durationTo) }}</td>
                            <td>{{ codeValue(row.schoolCollegeUniversity, row.schoolCollegeUniversityBN) }}</td>
                            <td>{{ codeValue(row.nameOfExamDegree, row.nameOfExamDegreeBN) }}</td>
                            <td>{{ codeValue(row.subjectsDepartments, row.subjectsDepartmentsBN) }}</td>
                            <td>{{ codeValue(row.result, row.resultBN) }}</td>
                            <td>{{ valDisplay(row.gradePoint) }}</td>
                            <td>{{ valDisplay(row.passingYear) }}</td>
                            <!-- <td>{{ val(row.remarks) }}</td> -->
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="9" class="text-center text-500 py-3">{{ L['empty.noEducationRecords'] }}</td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>

          <!-- Course Information -->
          <div class="content-section text-900 border-top-1 surface-border">
            <div class="section-heading">{{ L['section.course'] }}</div>
            <div class="family-table-wrapper">
                <p-table
                    [value]="courseList"
                    [tableStyle]="{ 'min-width': '44rem' }"
                    styleClass="p-datatable-sm p-datatable-gridlines family-info-table"
                >
                    <ng-template pTemplate="header">
                        <tr>
                            <th style="width: 4rem">{{ L['table.ser'] }}</th>
                            <th>{{ L['table.courseType'] }}</th>
                            <th>{{ L['table.courseName'] }}</th>
                            <th>{{ L['table.trainingInstitute'] }}</th>
                            <th>{{ L['table.dateFrom'] }}</th>
                            <th>{{ L['table.dateTo'] }}</th>
                            <th>{{ L['table.result'] }}</th>
                            <th>{{ L['table.auth'] }}</th>
                            <th>{{ L['table.remarks'] }}</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-row let-rowIndex="rowIndex">
                        <tr>
                            <td>{{ rowNum(rowIndex) }}.</td>
                            <td>{{ codeValue(row.courseType, row.courseTypeBN) }}</td>
                            <td>{{ codeValue(row.courseName, row.courseNameBN) }}</td>
                            <td>{{ val(row.trainingInstituteName) }}</td>
                            <td>{{ formatDateOnly(row.dateFrom) }}</td>
                            <td>{{ formatDateOnly(row.dateTo) }}</td>
                            <td>{{ val(row.result) }}</td>
                            <td>{{ val(row.auth) }}</td>
                            <td>{{ val(row.remarks) }}</td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="9" class="text-center text-500 py-3">{{ L['empty.noCourseRecords'] }}</td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>

        <!-- Investigation Experience -->
        <div class="content-section text-900 border-top-1 surface-border">
            <div class="section-heading">{{ L['section.investigation'] }}</div>
            <div class="core-details">
                @if (profile?.hasInvestigationExp === true) {
                    <div class="core-row core-row-full">
                        <span class="detail-item"><span class="detail-label">{{ L['field.details'] }} </span> <span class="detail-value">{{ val(profile.investigationExpDetails) }}</span></span>
                    </div>
                } @else {
                    <div class="address-empty text-500 py-2">{{ L['empty.noInvestigationRecorded'] }}</div>
                }
            </div>
        </div>

        <!-- Foreign Visit Information -->
        <div class="content-section text-900 border-top-1 surface-border">
            <div class="section-heading">{{ L['section.foreignVisit'] }}</div>

            <!-- Official Foreign Visit -->
            <div class="foreign-visit-subsection">
                <div class="subsection-heading">{{ L['section.officialForeignVisit'] }}</div>
                <div class="family-table-wrapper">
                    <p-table
                        [value]="officialForeignVisitList"
                        [tableStyle]="{ 'min-width': '44rem' }"
                        styleClass="p-datatable-sm p-datatable-gridlines family-info-table"
                    >
                        <ng-template pTemplate="header">
                            <tr>
                                <th style="width: 4rem">{{ L['table.ser'] }}</th>
                                <th>{{ L['table.country'] }}</th>
                                <th>{{ L['table.durationFrom'] }}</th>
                                <th>{{ L['table.durationTo'] }}</th>
                                <th>{{ L['table.reasonForVisiting'] }}</th>
                                <th>{{ L['table.relatedDocuments'] }}</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-row let-rowIndex="rowIndex">
                            <tr>
                                <td>{{ rowNum(rowIndex) }}.</td>
                                <td>{{ codeValue(row.nameOfCountry, row.nameOfCountryBN) }}</td>
                                <td>{{ formatDateOnly(row.durationFrom) }}</td>
                                <td>{{ formatDateOnly(row.durationTo) }}</td>
                                <td>{{ codeValue(row.reasonForVisiting, row.reasonForVisitingBN) }}</td>
                                <td>{{ val(row.relatedDocuments) }}</td>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td colspan="6" class="text-center text-500 py-3">{{ L['empty.noOfficialForeignVisit'] }}</td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </div>

            <!-- Unofficial Foreign Visit -->
            <div class="foreign-visit-subsection">
                <div class="subsection-heading">{{ L['section.unofficialForeignVisit'] }}</div>
                <div class="family-table-wrapper">
                    <p-table
                        [value]="unofficialForeignVisitList"
                        [tableStyle]="{ 'min-width': '44rem' }"
                        styleClass="p-datatable-sm p-datatable-gridlines family-info-table"
                    >
                        <ng-template pTemplate="header">
                            <tr>
                                <th style="width: 4rem">{{ L['table.ser'] }}</th>
                                <th>{{ L['table.country'] }}</th>
                                <th>{{ L['table.durationFrom'] }}</th>
                                <th>{{ L['table.durationTo'] }}</th>
                                <th>{{ L['table.reasonForVisiting'] }}</th>
                                <th>{{ L['table.relatedDocuments'] }}</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-row let-rowIndex="rowIndex">
                            <tr>
                                <td>{{ rowNum(rowIndex) }}.</td>
                                <td>{{ codeValue(row.nameOfCountry, row.nameOfCountryBN) }}</td>
                                <td>{{ formatDateOnly(row.durationFrom) }}</td>
                                <td>{{ formatDateOnly(row.durationTo) }}</td>
                                <td>{{ codeValue(row.reasonForVisiting, row.reasonForVisitingBN) }}</td>
                                <td>{{ val(row.relatedDocuments) }}</td>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td colspan="6" class="text-center text-500 py-3">{{ L['empty.noUnofficialForeignVisit'] }}</td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </div>
        </div>

        <!-- Leave (Current Year) -->
        <div class="content-section text-900 border-top-1 surface-border">
            <div class="section-heading flex align-items-center gap-2">
                <span>{{ L['section.leave'] }} ({{ currentYearDisplay }})</span>
                <i
                    class="pi pi-info-circle cursor-pointer text-primary"
                    [pTooltip]="L['tooltip.viewPreviousYearLeaveSummary']"
                    (click)="openPreviousYearLeaveSummary()"
                    [attr.aria-label]="L['tooltip.viewPreviousYearLeaveSummary']"
                ></i>
            </div>
            <div class="family-table-wrapper">
                <p-table
                    [value]="leaveList"
                    [tableStyle]="{ 'min-width': '36rem' }"
                    styleClass="p-datatable-sm p-datatable-gridlines family-info-table"
                >
                    <ng-template pTemplate="header">
                        <tr>
                            <th style="width: 4rem">{{ L['table.ser'] }}</th>
                            <th>{{ L['table.typeOfLeave'] }}</th>
                            <th>{{ L['table.durationFrom'] }}</th>
                            <th>{{ L['table.durationTo'] }}</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-row let-rowIndex="rowIndex">
                        <tr>
                            <td>{{ rowNum(rowIndex) }}.</td>
                            <td>{{ codeValue(row.typeOfLeave, row.typeOfLeaveBN) }}</td>
                            <td>{{ formatDateOnly(row.durationFrom) }}</td>
                            <td>{{ formatDateOnly(row.durationTo) }}</td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="4" class="text-center text-500 py-3">{{ L['empty.noLeaveCurrentYear'] }}</td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>

        <!-- Discipline Information -->
        <div class="content-section text-900 border-top-1 surface-border">
            <div class="section-heading">{{ L['section.discipline'] }}</div>
            <div class="family-table-wrapper">
                <p-table
                    [value]="disciplineList"
                    [tableStyle]="{ 'min-width': '56rem' }"
                    styleClass="p-datatable-sm p-datatable-gridlines family-info-table"
                >
                    <ng-template pTemplate="header">
                        <tr>
                            <th style="width: 4rem">{{ L['table.ser'] }}</th>
                            <th>{{ L['table.offenseDate'] }}</th>
                            <th>{{ L['table.offenseType'] }}</th>
                            <th>{{ L['table.briefStatement'] }}</th>
                            <th>{{ L['table.offenseDetails'] }}</th>
                            <th>{{ L['table.punishmentRab'] }}</th>
                            <th>{{ L['table.punishmentDate'] }}</th>
                            <th>{{ L['table.punishmentMo'] }}</th>
                            <th>{{ L['table.punishmentDateMo'] }}</th>
                            <th>{{ L['table.auth'] }}</th>
                            <th>{{ L['table.remarks'] }}</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-row let-rowIndex="rowIndex">
                        <tr>
                            <td>{{ rowNum(rowIndex) }}.</td>
                            <td>{{ formatDateOnly(row.offenseDate) }}</td>
                            <td>{{ codeValue(row.offenseType, row.offenseTypeBN) }}</td>
                            <td>{{ codeValue(row.briefStatementOfOffence, row.briefStatementOfOffenceBN) }}</td>
                            <td>{{ val(row.offenseDetails) }}</td>
                            <td>{{ codeValue(row.punishmentTypeRAB, row.punishmentTypeRABBN) }}</td>
                            <td>{{ formatDateOnly(row.punishmentDate) }}</td>
                            <td>{{ codeValue(row.punishmentTypeMotherOrg, row.punishmentTypeMotherOrgBN) }}</td>
                            <td>{{ formatDateOnly(row.punishmentDateMotherOrg) }}</td>
                            <td>{{ val(row.auth) }}</td>
                            <td>{{ val(row.remarks) }}</td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="11" class="text-center text-500 py-3">{{ L['empty.noDisciplineRecords'] }}</td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>

          <!-- Bank Account Information -->
          <div class="content-section text-900 border-top-1 surface-border">
            <div class="section-heading">{{ L['section.bankAccount'] }}</div>
            <div class="family-table-wrapper">
                <p-table
                    [value]="bankAccList"
                    [tableStyle]="{ 'min-width': '40rem' }"
                    styleClass="p-datatable-sm p-datatable-gridlines family-info-table"
                >
                    <ng-template pTemplate="header">
                        <tr>
                            <th style="width: 4rem">{{ L['table.ser'] }}</th>
                            <th>{{ L['table.bankName'] }}</th>
                            <th>{{ L['table.branchName'] }}</th>
                            <th>{{ L['table.accountName'] }}</th>
                            <th>{{ L['table.accountNumber'] }}</th>
                            <th>{{ L['table.remarks'] }}</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-row let-rowIndex="rowIndex">
                        <tr>
                            <td>{{ rowNum(rowIndex) }}.</td>
                            <td>{{ codeValue(row.bankName, row.bankNameBN) }}</td>
                            <td>{{ codeValue(row.branchName, row.branchNameBN) }}</td>
                            <td>{{ codeValue(row.accountName, row.accountNameBN) }}</td>
                            <td>{{ valDisplay(row.accountNumber) }}</td>
                            <td>{{ val(row.remarks) }}</td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="6" class="text-center text-500 py-3">{{ L['empty.noBankAccountRecords'] }}</td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>


        <!-- Additional Remarks -->
        <div class="content-section text-900 border-top-1 surface-border">
            <div class="section-heading">{{ L['section.additionalRemarks'] }}</div>
            <div class="family-table-wrapper">
                <p-table
                    [value]="additionalRemarksList"
                    [tableStyle]="{ 'min-width': '40rem' }"
                    styleClass="p-datatable-sm p-datatable-gridlines family-info-table"
                >
                    <ng-template pTemplate="header">
                        <tr>
                            <th style="width: 4rem">{{ L['table.ser'] }}</th>
                            <th>{{ L['table.additionalRemarks'] }}</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-row let-rowIndex="rowIndex">
                        <tr>
                            <td>{{ rowNum(rowIndex) }}.</td>
                            <td>{{ val(row.additionalRemarks) }}</td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="2" class="text-center text-500 py-3">{{ L['empty.noAdditionalRemarks'] }}</td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>

        <!-- Documents (files from PersonalInfo, EmployeeInfo, PreviousRABServiceInfo, etc.) -->
        <div class="content-section text-900 border-top-1 surface-border">
            <div class="section-heading">{{ L['section.documents'] }}</div>
            @if (documentList.length === 0) {
                <div class="text-500 py-2">{{ L['empty.noDocuments'] }}</div>
            } @else {
                <p-table
                    [value]="documentList"
                    styleClass="p-datatable-sm p-datatable-gridlines"
                    [tableStyle]="{ 'min-width': '24rem' }"
                >
                    <ng-template pTemplate="header">
                        <tr>
                            <th style="width: 2rem">{{ L['table.hash'] }}</th>
                            <th>{{ L['table.section'] }}</th>
                            <th>{{ L['table.fileName'] }}</th>
                            <th style="width: 8rem">{{ L['table.action'] }}</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-row let-rowIndex="rowIndex">
                        <tr>
                            <td>{{ rowNum(rowIndex) }}.</td>
                            <td>{{ getDocumentSourceLabel(row) }}</td>
                            <td>{{ getDocumentFileName(row) }}</td>
                            <td>
                                <p-button
                                    icon="pi pi-download"
                                    [label]="L['button.download']"
                                    [rounded]="true"
                                    [text]="true"
                                    severity="secondary"
                                    size="small"
                                    (onClick)="downloadDocument(row)"
                                    [pTooltip]="L['tooltip.downloadFile']"
                                ></p-button>
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="4" class="text-center text-500 py-3">{{ L['empty.noDocuments'] }}</td>
                        </tr>
                    </ng-template>
                </p-table>
            }
        </div>
        
       
    } @else if (!loading) {
        <p class="text-500 m-0">{{ L['empty.noProfileData'] }}</p>
    }
</div>

<!-- Previous Year Leave Summary Dialog -->
<p-dialog
    [header]="L['dialog.previousYearLeaveSummary'] + ' (' + previousYearDisplay + ')'"
    [(visible)]="previousYearSummaryDialogVisible"
    [modal]="true"
    [style]="{ width: '28rem' }"
    [closable]="true"
    (onHide)="closePreviousYearSummaryDialog()"
    styleClass="text-900"
>
    @if (previousYearSummaryLoading) {
        <div class="flex align-items-center justify-content-center py-4">
            <i class="pi pi-spin pi-spinner text-2xl text-500"></i>
        </div>
    } @else {
        <p-table
            [value]="previousYearSummary"
            styleClass="p-datatable-sm p-datatable-gridlines"
            [tableStyle]="{ 'min-width': '20rem' }"
        >
            <ng-template pTemplate="header">
                <tr>
                    <th>{{ L['table.typeOfLeave'] }}</th>
                    <th style="width: 5rem">{{ L['table.count'] }}</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-row>
                <tr>
                    <td>{{ val(row.typeOfLeave) }}</td>
                    <td>{{ valDisplay(row.count) }}</td>
                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="2" class="text-center text-500 py-2">{{ L['empty.noLeavePreviousYear'] }}</td>
                </tr>
            </ng-template>
        </p-table>
    }
</p-dialog>
